<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout</title>
  <link rel="stylesheet" href="base.css" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="checkout.css" />
  <link rel="stylesheet" href="product.css" />
  <script type="module" src="search.js"></script>
  <script type="module" src="currency.js"></script>
  <script type="module" src="currency-init.js"></script>
  <script src="data.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
</head>

<body class="sticky-footer">
  <!-- ‚úÖ Shared Header -->
  <header class="navbar">
    <div class="nav-left">
      <a href="index.html" class="logo">
        <img src="DEADSTOCK (3).png" alt="DeadstockBlvd Logo" class="logo-img" />
      </a>
    </div>
    <div class="nav-right">
      <button id="cartIcon" class="cart-wrapper icon-button">
        <img src="CartIcon.png" alt="Cart" class="cart-icon" />
        <span id="cart-count">0</span>
      </button>
    </div>
  </header>

    <div id="preloader">
      <div class="loader">Loading...</div>
    </div>

    <!-- ‚úÖ Search Bar Container (below navbar) -->
    <div id="searchBarContainer">
      <div class="search-input-wrapper">
        <input
          type="text"
          id="searchInput"
          placeholder="Search products..."
          autocomplete="off"
        />
        <button id="clearSearch" aria-label="Clear Search">&times;</button>
      </div>
        
        <!-- ‚úÖ Shared scroll wrapper for both -->
        <div id="searchScrollableArea">
            <ul id="searchSuggestions" class="search-suggestions"></ul>
            
            <div id="searchResultsWrapper">
                <p id="noResultsMessage" style="display: none;">No products found.</p>
                <div id="searchResults"></div>
            </div>
        </div>
    </div>
    
    <!-- ‚úÖ Search overlay now OUTSIDE the container -->
    <div id="searchOverlay"></div>

  <!-- ‚úÖ Main Checkout Layout -->
  <main id="checkoutWrapper">
    <section class="checkout-left">
      <h2>Payment Section</h2>
      <form action="https://sandbox.payfast.co.za/eng/process" method="POST" id="payfastCheckoutForm">
        <input type="hidden" name="merchant_id" value="10041066" />
        <input type="hidden" name="merchant_key" value="itdun3pbyglz7" />
        
        <input type="hidden" name="return_url" value="https://sbrixton.github.io/DeadstockBlvd/success.html" />
        <input type="hidden" name="cancel_url" value="https:/DeadstockBlvd.com/cancel.html" />
        <input type="hidden" name="notify_url" value="https://deadstockblvd.wuaze.com/basic%20notify.php" />
        
        <input type="hidden" name="m_payment_id" value="12345" />
        <input type="hidden" name="amount" id="checkoutPayfastAmount" value="" />
        <input type="hidden" name="item_name" id="checkoutPayfastItem" value="" />
        <input type="hidden" name="currency" value="ZAR" />
        
        <button type="submit" class="payfast-btn">Pay with PayFast (Demo)</button>
      </form>
      <!-- ‚úÖ Terms Agreement Section -->
      <div class="checkout-agreement">
        I 
        <input type="checkbox" id="termsCheckbox" />
        agree and understand the
        <a id="showTerms">Terms & Conditions</a> of this website.
      </div>
      
      <!-- ‚úÖ Terms Modal -->
      <div id="termsModal" class="modal">
        <div class="modal-content">
          <span class="close-modal">&times;</span>
          <h3>Terms & Conditions</h3>
          <p>
            By placing an order, you agree to DeadstockBlvd‚Äôs terms including return policies,
            privacy rights, and payment rules. Read carefully before continuing.
            
            OVERVIEW
            This website is operated by [Your Site Name]. 
            Throughout the site, the terms ‚Äúwe‚Äù, ‚Äúus‚Äù and ‚Äúour‚Äù refer to [Your Site Name].
            [Your Site Name] offers this website, including all information, 
            tools and services available from this site to you, the user, 
            conditioned upon your acceptance of all terms, conditions, policies and notices stated here.
            
            By visiting our site and/or purchasing access to a product link or service, 
            you engage in our ‚ÄúService‚Äù and agree to be bound by the following terms and conditions
            (‚ÄúTerms of Service‚Äù, ‚ÄúTerms‚Äù), including those additional terms and policies referenced herein 
            and/or available by hyperlink. These Terms apply to all users of the site, 
            including without limitation users who are browsers, purchasers, contributors of content, or affiliates.
            
            Please read these Terms of Service carefully before accessing or using our website.
            If you do not agree to all the terms and conditions, then you may not access the site or use any services. 
            If these Terms of Service are considered an offer, acceptance is expressly limited to these Terms.

            Any new features or tools added to the current site shall also be subject to the Terms of Service. 
            You can review the most current version at any time on this page. We reserve the right to update, 
            change or replace any part of these Terms by posting updates on the website. 
            Your continued use of the site constitutes acceptance of those changes.

            
            SECTION 1 - USE OF THE SITE
            
            By agreeing to these Terms, you confirm that you are at least the age of majority in your jurisdiction,
            or that you are the age of majority and have given consent for any minor dependents to use this site.
            
            You may not use our content or products for any illegal or unauthorized purpose, nor may you,
            in the use of the Service, violate any laws in your jurisdiction 
            (including but not limited to copyright or data protection laws).
            
            A breach or violation of any of the Terms will result in an immediate termination of your Services.

            
            SECTION 2 - NATURE OF PRODUCTS
            
            [Your Site Name] provides users with access to curated product links, 
            exclusive or early access links, affiliate links, or other digital information relating to third-party products. 
            We do not own or sell the physical products linked to, and we are not responsible for the final delivery, 
            performance, or condition of any third-party items.
            
            Use of our service grants you access to information or links and does not guarantee stock availability, 
            pricing accuracy, or purchase success on third-party platforms.

            
            SECTION 3 - BILLING AND ACCESS
            
            You agree to provide accurate, current, and complete information for all purchases made via our site.
            
            We reserve the right to limit, refuse or cancel access if we suspect you have provided false information, 
            violated our terms, or engaged in misuse of the Service.
            
            Some services may be subscription-based or one-time purchases. All sales are final unless otherwise stated.

            
            SECTION 4 - MODIFICATIONS TO THE SERVICE
            
            We reserve the right to modify or discontinue the Service (or any part of it) at any time without notice.
            
            We are not liable to you or any third-party for any modification, price change, suspension, or discontinuance of the Service.

            
            SECTION 5 - THIRD-PARTY PRODUCTS & LINKS
            
            Our platform is built on external product links and references to third-party websites. 
            We do not control, manage, or guarantee the accuracy, availability, or safety of those external platforms or products.
            
            Any purchase, dispute, return, or warranty issue regarding a product linked from our site must be handled directly with
            the third-party seller. We are not responsible for the outcome of your interaction with external websites.

            
            SECTION 6 - ACCURACY, COMPLETENESS, AND ERRORS
            
            While we aim to keep information up-to-date and accurate, the site may occasionally contain errors, 
            outdated info, or inaccuracies ‚Äî particularly with product descriptions, pricing, availability, or link functionality.
            
            We reserve the right to correct any errors or cancel access if necessary, without notice.

            
            SECTION 7 - PROHIBITED USES
            
            You are prohibited from using the site or its content:
            
            For unlawful purposes
            
            To violate any laws or regulations
            
            To exploit or mislead users
            
            To scrape or mine data
            
            To interfere with or bypass the functionality or security of the site
            
            To reproduce, sell, or redistribute access to links or digital products without consent
            
            We reserve the right to terminate your access for any misuse of the Service.

            
            SECTION 8 - DISCLAIMER OF WARRANTIES; LIMITATION OF LIABILITY
            
            We do not guarantee that use of the Service will be uninterrupted or error-free. 
            The service is provided ‚Äúas is‚Äù and ‚Äúas available‚Äù without any warranties, express or implied.
            
            We make no guarantees about:
            
            The reliability or accuracy of product links
            
            Third-party product availability
            
            Purchase success from external retailers
            
            Any specific results from using the Service
            
            In no case shall [Your Site Name] be liable for any direct, indirect, 
            incidental or consequential damages arising from your use of the Service or reliance on the content provided.

            
            SECTION 9 - INDEMNIFICATION
            
            You agree to indemnify and hold harmless [Your Site Name] and its owners, partners, 
            affiliates, and employees from any claims, liabilities, or damages arising from your use of the Service, 
            your breach of the Terms, or your violation of any rights or laws.


            SECTION 10 - TERMINATION
            
            These Terms remain in effect unless and until terminated by either party. 
            You may terminate by discontinuing use of the Service. We may terminate access at any time for any breach,
            suspected misuse, or at our sole discretion.

            
            SECTION 11 - GOVERNING LAW
          
            These Terms and any disputes related to them shall be governed by and construed in accordance with
            the laws of the United Kingdom.

            
            SECTION 12 - ENTIRE AGREEMENT
            These Terms constitute the entire agreement between you and [Your Site Name], 
            superseding any prior agreements. Any ambiguities shall not be construed against the drafting party.

            
            SECTION 13 - CONTACT INFORMATION
            For questions or concerns regarding these Terms of Service, please contact us at:

            
            [Your Site Name]
            Email: [your@email.com]
            Registered Business Address: [Insert if applicable]
            Business Registration Number: [Optional]
            VAT Number: [Optional]
          </p>
        </div>
      </div>
            
      <!-- ‚úÖ Page Overlay -->
      <div id="pageOverlay"></div>
    </section>
    
    <!-- ‚úÖ Order Summary Toggle (Mobile) -->
    <!-- ‚úÖ Mobile Order Summary Toggle -->
    <div class="order-summary-toggle" id="orderSummaryToggle">
      <span id="orderSummaryToggleText">
        Order summary <span id="orderSummaryArrow">‚ñº</span>
      </span>
      <span id="orderSummarySubtotal" class="currency-subtotal">Loading...</span>
    </div>
    
    <!-- ‚úÖ Collapsible Order Summary Section -->
    <section class="checkout-right" id="checkoutRightSection">
      <div id="checkoutProducts" class="checkout-products-list"></div>
      
      <div class="shipping-row">
        <span>Shipping:</span>
        <span class="free-tag">FREE</span>
      </div>
      
    <div class="checkout-subtotal">
      Subtotal: <strong id="checkoutSubtotal" class="currency-subtotal">Loading...</strong>
    </div>
    </section>
    
  </main>

    <!-- Mobile Slide-in Cart Drawer -->
  <div id="mobileCartDrawer">
      <div id="mobileCartHeader">
          <h3>Your Cart</h3>
          <button id="closeCartDrawer">&times;</button>
      </div>
      <div id="mobileCartItems"></div>
      <div id="mobileCartFooter">
          <div class="footer-totals">
              <p>Subtotal: <span id="drawerCartSubtotal">0.00</span></p>
          </div>
          <button id="drawerCheckoutBtn" class="checkout-bar">Checkout</button>
      </div>
  </div>
  
  <!-- üî¥ New: Backdrop for closing drawer on outside click -->
  <div id="cartBackdrop" class="cart-backdrop"></div>

  <script>
      window.addEventListener("load", () => {
      const preloader = document.getElementById("preloader");
      preloader.style.opacity = "0";
      setTimeout(() => {
        preloader.style.display = "none";
      }, 500);
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const addToCartBtn = document.getElementById('addToCartBtn');
      const pfAmount = document.getElementById('pfAmount');
      const pfItemName = document.getElementById('pfItemName');
      
      if (addToCartBtn && pfAmount && pfItemName) {
        // Get product price & name from Add to Cart button data attributes
        const price = addToCartBtn.getAttribute('data-price');
        const name = addToCartBtn.getAttribute('data-name');
        
        // Format price to two decimals (e.g., "35.00")
        const formattedPrice = parseFloat(price).toFixed(2);
      
        // Update PayFast form hidden inputs
        pfAmount.value = formattedPrice;
        pfItemName.value = name;
      }
    });
  </script>
  
  <!-- ‚úÖ Add this at the bottom, before </body> -->
  <script type="module">
    import {
      setCurrency,
      getCurrency,
      formatPrice
    } from './currency.js';
    
    document.addEventListener('DOMContentLoaded', async () => {
      const addToCartBtn = document.getElementById("addToCartBtn");
      const basePriceGBP = parseFloat(addToCartBtn?.dataset.price || 0);
      const priceEl = document.getElementById("convertedPrice");
      const selector = document.getElementById("currencySelector");
      
      async function updatePriceDisplay() {
        priceEl.innerHTML = await formatPrice(basePriceGBP);
      }
      
      selector.value = getCurrency();
      selector.addEventListener('change', async (e) => {
        setCurrency(e.target.value);
        await updatePriceDisplay();
      });
      
      await updatePriceDisplay();
    });
  </script>

  <script type="module">
    import { formatPrice, getCurrency, setCurrency } from './currency.js';
        
    document.addEventListener('DOMContentLoaded', async () => {
      const priceEls = document.querySelectorAll('.converted-price');
        
      for (let el of priceEls) {
        const gbp = parseFloat(el.dataset.gbp);
        el.innerText = await formatPrice(gbp);
      }
    });
  </script>
  
  <script type="module" src="navbar.js"></script>
  <script type="module" src="script.js" defer></script>
  <script type="module" src="cart.js"></script>
  <script type="module" src="checkout.js"></script>
</body>
</html>



