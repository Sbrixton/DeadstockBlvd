<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Page</title>
  <link rel="stylesheet" href="base.css">
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="product.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
  <script type="module" src="navbar.js"></script>
  <script src="data.js"></script>
  <script type="module" src="script.js" defer></script>
</head>
<body>
    <header class="navbar">
      <div class="nav-left">
        <a href="index.html" class="logo">
          <img src="DEADSTOCK (3).png" alt="DeadstockBlvd Logo" height="50" />
        </a>
        
        <div class="nav-wrapper" id="navWrapper">
          <nav id="navbar">
            <i id="close" class="fas fa-times"></i>
            <a href="index.html">Home</a>
            <a href="shop.html" class="active">Shop</a>
            <a href="Contact.html">Contact</a>
          </nav>
        </div>
        <i id="bar" class="fas fa-bars"></i>
      </div>
      
      <div class="nav-right">
        <button id="searchIcon">
          <img src="SearchIcon.png" alt="Search" class="search-icon" style="height: 30px" />
        </button>
        <div id="cartIcon" class="cart-wrapper" role="button" tabindex="0">
          <img src="CartIcon.png" alt="Cart" class="cart-icon" style="height: 30px" />
          <span id="cart-count">0</span>
        </div>
      </div>
    </header>
    
    <!-- ✅ Search Bar Container (below navbar) -->
    <div id="searchBarContainer">
      <div class="search-input-wrapper">
        <input
          type="text"
          id="searchInput"
          placeholder="Search products..."
          autocomplete="off"
        />
        <button id="clearSearch" aria-label="Clear Search">&times;</button>
      </div>
        
        <!-- ✅ Shared scroll wrapper for both -->
        <div id="searchScrollableArea">
            <ul id="searchSuggestions" class="search-suggestions"></ul>
            
            <div id="searchResultsWrapper">
                <p id="noResultsMessage" style="display: none;">No products found.</p>
                <div id="searchResults"></div>
            </div>
        </div>
    </div>
    
    <!-- ✅ Search overlay now OUTSIDE the container -->
    <div id="searchOverlay"></div>
    
    <div class="success-wrapper">
      <div class="checkmark-circle">
        <span class="checkmark">&#10003;</span>
      </div>
      <div class="thank-you">Thank you!</div>
      <div class="order-received">Your order has been received.</div>
      <a href="index.html" class="return-home">Return Home</a>
    </div>
    
    <footer class="section-p1">
        <div class="col install">
            <p>Secured Payment Gateways</p>
            <img src="payments.png" alt="">
        </div>
            
        <div class="copyright">
            <p>© 2025, DeadstockBlvd</p>
        </div>
    </footer>
    
    <!-- Mobile Slide-in Cart Drawer -->
    <div id="mobileCartDrawer">
        <div id="mobileCartHeader">
            <h3>Your Cart</h3>
            <button id="closeCartDrawer">&times;</button>
        </div>
        <div id="mobileCartItems"></div>
        <div id="mobileCartFooter">
            <div class="footer-totals">
                <p>Subtotal: <span id="drawerCartSubtotal">0.00</span></p>
            </div>
            <button id="drawerCheckoutBtn" class="checkout-bar">Checkout</button>
        </div>
    </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const addToCartBtn = document.getElementById('addToCartBtn');
      const pfAmount = document.getElementById('pfAmount');
      const pfItemName = document.getElementById('pfItemName');
      
      if (addToCartBtn && pfAmount && pfItemName) {
        // Get product price & name from Add to Cart button data attributes
        const price = addToCartBtn.getAttribute('data-price');
        const name = addToCartBtn.getAttribute('data-name');
        
        // Format price to two decimals (e.g., "35.00")
        const formattedPrice = parseFloat(price).toFixed(2);
      
        // Update PayFast form hidden inputs
        pfAmount.value = formattedPrice;
        pfItemName.value = name;
      }
    });
  </script>
  
  <!-- ✅ Add this at the bottom, before </body> -->
  <script type="module">
    import {
      setCurrency,
      getCurrency,
      formatPrice
    } from './currency.js';
    
    document.addEventListener('DOMContentLoaded', async () => {
      const basePriceGBP = 86; // or dynamically fetch from data attribute
      const priceEl = document.getElementById("convertedPrice");
      const selector = document.getElementById("currencySelector");
      
      async function updatePriceDisplay() {
        priceEl.innerHTML = await formatPrice(basePriceGBP);
      }
      
      selector.value = getCurrency();
      selector.addEventListener('change', async (e) => {
        setCurrency(e.target.value);
        await updatePriceDisplay();
      });
      
      await updatePriceDisplay();
    });
  </script>

  <script type="module">
    import { formatPrice, getCurrency, setCurrency } from './currency.js';
        
    document.addEventListener('DOMContentLoaded', async () => {
      const priceEls = document.querySelectorAll('.converted-price');
        
      for (let el of priceEls) {
        const gbp = parseFloat(el.dataset.gbp);
        el.innerText = await formatPrice(gbp);
      }
    });
  </script>

  <script type="module" src="search.js"></script>
  <script type="module" src="product.js"></script>
  <script type="module" src="cart.js"></script>
  <script type="module" src="currency.js"></script>
  <script type="module" src="currency-init.js"></script>
</body>
</html>
