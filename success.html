<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Page</title>
  <link rel="stylesheet" href="base.css">
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="product.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
  <script type="module" src="navbar.js"></script>
  <script src="data.js"></script>
  <script type="module" src="script.js" defer></script>
</head>
<body class="sticky-footer" >
  <div class="page-wrapper">
    <header class="navbar">
      <div class="nav-left">
        <a href="home.html" class="logo">
          <img src="DEADSTOCK (3).png" alt="DeadstockBlvd Logo" height="50" />
        </a>
      </div>
      
      <div class="nav-right">
        <button id="cartIcon" class="cart-wrapper icon-button">
          <img src="CartIcon.png" alt="Cart" class="cart-icon" />
          <span id="cart-count">0</span>
        </button>
      </div>
    </header>
    
      <!-- ✅ Search Bar -->

      <!-- ✅ Main Content -->
    <main class="section-p1">
      <div class="success-wrapper">
        <div class="checkmark-circle">
          <span class="checkmark">&#10003;</span>
        </div>
        <div class="thank-you">Thank you!</div>
        <div class="order-received">Your order has been received.</div>
        <a href="index.html" class="return-home">Return Home</a>
      </div>
    </main>
    
    <!-- Mobile Slide-in Cart Drawer -->
    <div id="mobileCartDrawer">
        <div id="mobileCartHeader">
            <h3>Your Cart</h3>
            <button id="closeCartDrawer">&times;</button>
        </div>
        <div id="mobileCartItems"></div>
        <div id="mobileCartFooter">
            <div class="footer-totals">
                <p>Subtotal: <span id="drawerCartSubtotal">0.00</span></p>
            </div>
            <button id="drawerCheckoutBtn" class="checkout-bar">Checkout</button>
        </div>
    </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const addToCartBtn = document.getElementById('addToCartBtn');
        const pfAmount = document.getElementById('pfAmount');
        const pfItemName = document.getElementById('pfItemName');
        
        if (addToCartBtn && pfAmount && pfItemName) {
          // Get product price & name from Add to Cart button data attributes
          const price = addToCartBtn.getAttribute('data-price');
          const name = addToCartBtn.getAttribute('data-name');
        
          // Format price to two decimals (e.g., "35.00")
          const formattedPrice = parseFloat(price).toFixed(2);
          
          // Update PayFast form hidden inputs
          pfAmount.value = formattedPrice;
          pfItemName.value = name;
        }
      });
    </script>
    
    <!-- ✅ Add this at the bottom, before </body> -->
    <script type="module">
      import {
        setCurrency,
        getCurrency,
        formatPrice
      } from './currency.js';
      
      document.addEventListener('DOMContentLoaded', async () => {
        const basePriceGBP = 86; // or dynamically fetch from data attribute
        const priceEl = document.getElementById("convertedPrice");
        const selector = document.getElementById("currencySelector");
        
        async function updatePriceDisplay() {
          priceEl.innerHTML = await formatPrice(basePriceGBP);
        }
        
        selector.value = getCurrency();
        selector.addEventListener('change', async (e) => {
          setCurrency(e.target.value);
          await updatePriceDisplay();
        });
        
        await updatePriceDisplay();
      });
    </script>
    
    <script type="module">
      import { formatPrice, getCurrency, setCurrency } from './currency.js';
        
      document.addEventListener('DOMContentLoaded', async () => {
        const priceEls = document.querySelectorAll('.converted-price');
        
        for (let el of priceEls) {
          const gbp = parseFloat(el.dataset.gbp);
          el.innerText = await formatPrice(gbp);
        }
      });
    </script>
    
    <script type="module" src="search.js"></script>
    <script type="module" src="product.js"></script>
    <script type="module" src="cart.js"></script>
    <script type="module" src="currency.js"></script>
    <script type="module" src="currency-init.js"></script>
  </div>
</body>
</html>
